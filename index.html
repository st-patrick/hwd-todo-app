<!doctype html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <meta name="theme-color" content="rgb(200, 215, 242)">
    <meta name="theme-color" content="rgb(133, 154, 182)" media="(prefers-color-scheme: light)">
    <meta name="theme-color" content="rgb(200, 215, 242)" media="(prefers-color-scheme: dark)">

    <style>
        .todo-input {
        }

        .btn-primary {
            background-color: #b1c9fe;
            border-color: #b1c9fe;
            color: #438594;
        }

        .ios-peek {
            position: fixed;
            z-index: -1;
            bottom: 0;
            left: 0;
            background: linear-gradient(rgb(200, 215, 242), rgb(183, 199, 227), rgb(166, 184, 212), rgb(149, 169, 197), rgb(133, 154, 182));
            height: 100vh;
            width: 100vw;
        }
    </style>

    <title>Todo list hwd 0</title>
</head>
<body style="background: linear-gradient(rgb(200, 215, 242), rgb(183, 199, 227), rgb(166, 184, 212), rgb(149, 169, 197), rgb(133, 154, 182));">

    <div class="container mt-3 mb-5">
        <div class="row">
            <div class="d-none d-lg-block col-lg-6 col-xxl-4 text-center">
                <h3>Projects</h3>
                <div>
                    <input class="form-control mb-2 project-input" type="text">
                    <input class="form-control mb-2 project-input" type="text">
                    <input class="form-control mb-2 project-input" type="text">
                    <input class="form-control mb-2 project-input" type="text">
                    <input class="form-control mb-2 project-input" type="text">
                </div>
                <div class="mb-2 text-center">
                    <button class="text-center btn btn-lg btn-primary fw-bold pb-3" onclick=" saveDizBitch();">save</button>
                    <button class="text-center btn btn-lg btn-primary fw-bold pb-3" onclick="addTodo();">new</button>
                    <button class="text-center btn btn-lg btn-primary fw-bold pb-3" onclick="sortTodos();">sort</button>
                </div>
                <br>
                <div class="text-center fw-bold" style="color: white;">
                    0
                </div>
                <br>
                <div class="">
                    hwd DONE something...
                </div>
                <div class="text-center fw-bold" style="color: white;">
                    0
                </div>
            </div>
            <div class="col-12 offset-md-1 col-md-10 offset-lg-0 col-lg-6 col-xxl-4 text-center">
                <h3>ToDos</h3>
                <div id="list">
                    <input class="form-control mb-2 todo-input" type="text">
                    <input class="form-control mb-2 todo-input" type="text">
                    <input class="form-control mb-2 todo-input" type="text">
                    <input class="form-control mb-2 todo-input" type="text">
                    <input class="form-control mb-2 todo-input" type="text">
                    <input class="form-control mb-2 todo-input" type="text">
                </div>
                <div class="mb-2 text-center">
                    <button class="text-center btn btn-lg btn-primary fw-bold pb-3" onclick="saveAll();">save</button>
                    <button class="text-center btn btn-lg btn-primary fw-bold pb-3" onclick="addTodo();">new</button>
                    <button class="text-center btn btn-lg btn-primary fw-bold pb-3" onclick="sortTodos();">sort</button>
                </div>
                <br>
                <div class="text-center fw-bold" id="count" style="color: white;">
                    0
                </div>
                <br>
                <div class="" id="done">
                    hwd DONE something...
                </div>
                <div class="text-center fw-bold" id="countDone" style="color: white;">
                    0
                </div>
            </div>
            <div class="col-12 offset-md-1 col-md-10 offset-lg-0 col-lg-6 col-xxl-4 text-center">
                <h3>Breakdown</h3>
                <div id="breakdown-list">
                    <textarea class="form-control mb-2 breakdown-input" type="text"></textarea>
                    <textarea class="form-control mb-2 breakdown-input" type="text"></textarea>
                    <textarea class="form-control mb-2 breakdown-input" type="text"></textarea>
                    <textarea class="form-control mb-2 breakdown-input" type="text"></textarea>
                </div>
                <div class="mb-2 text-center">
                    <button class="text-center btn btn-lg btn-primary fw-bold pb-3" onclick="addBreakdown();">new</button>
                </div>

            </div>
        </div>


        <br><br><br>

    </div>

    <div class="ios-peek">
    </div>

</body>
<!-- Option 1: Bootstrap Bundle with Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>

<script>

    let globalList = [];
    let globalBreakdownList = [];
    let globalTodoCount = 0;
    let globalDoneCount = 0;

    async function getJSONdata() {
        const request = new Request('https://api.npoint.io/09f00b9000d1a3a5902a', {method: 'GET'});

        return await thatFetchStuff(request);
    }

    async function thatFetchStuff(request) {
        let responseObject = {};

        await fetch(request)
            .then(response => {
                if (response.status === 200) {
                    return response.json();
                } else {
                    throw new Error('Something went wrong on api server!');
                }
            })
            .then(response => {
                responseObject = response;
                // ...
            }).catch(error => {
                console.error(error);
            });

        return responseObject;
    }

    async function main() {
        let response = await getJSONdata();
        globalList = response.list;
        globalBreakdownList = response.breakdowns;
        scoreSortRender();
    }

    function sortTodos() {
        getTodosFromInputs();
        scoreSortRender();
    }

    function scoreSortRender(){
        scoreTodos();
        globalList = globalList.sort(compareTodoScore);
        renderAll();
    }

    /* was not really necessary, we now work with the globallist object
    function convertToOnlyNames(objectList) {
        let listOnlyNames = [];
        for(let todo of objectList) {
            listOnlyNames.push(todo.name);
        }
        return listOnlyNames;
    }  */

    function addTodo(){
        let listDOM = document.getElementById('list');
        let content = "<input class=\"form-control mb-2 todo-input\" type=\"text\" placeholder=\"type here\">";
        listDOM.insertAdjacentHTML('beforeend', content);
    }

    function addBreakdown() {
        let listDOM = document.getElementById('breakdown-list');
        let content = "<textarea class=\"form-control mb-2 breakdown-input\" type=\"text\"></textarea>";
        listDOM.insertAdjacentHTML('beforeend', content);
    }


    async function renderTodos() {
        let listDOM = document.getElementById('list');
        let listHTML = "";

        let doneDOM = document.getElementById('done');
        let doneHTML = "";

        for(let todo of globalList) {

            if (todo.score < 0) {
                doneHTML += "<p>" + todo.name + "</p>";
            } else {
                listHTML += "<input class=\"form-control mb-2 todo-input\" type=\"text\" value=\"" + todo.name + "\" aria-label=\"default input example\">";
            }

        }

        listDOM.innerHTML = listHTML;
        doneDOM.innerHTML = doneHTML;

        document.getElementById('count').innerHTML = globalTodoCount;
        document.getElementById('countDone').innerHTML = globalDoneCount;
    }

    async function renderAll() {
        renderTodos();

        let listDOM = document.getElementById('breakdown-list');
        let listHTML = "";

        for(let breakdown of globalBreakdownList) {
            listHTML += "<textarea class=\"form-control mb-2 breakdown-input\" type=\"text\">" + breakdown + "</textarea>";
        }

        listDOM.innerHTML = listHTML;
    }

    /*
     * assigns each ToDo a score based on the first letters code
     */
    function scoreTodos() {

        globalDoneCount = 0;
        globalTodoCount = 0;

        for(let todo of globalList) {

            if(todo.name.includes("DONE")) {

                todo.score = -1;
                globalDoneCount++;

            } else {

                let highImpact = todo.name.charAt(0);
                let importance = todo.name.charAt(1);
                let urgency = todo.name.charAt(2);

                if (highImpact != '-') {
                    highImpact = 100;
                } else { highImpact = 0; }
                if (importance != '-') {
                    importance = 10;
                } else { importance = 0; }
                if (urgency != '-') {
                    urgency = 1;
                } else { urgency = 0; }

                todo.score = highImpact + importance + urgency;
                globalTodoCount++;

            }

        }

    }

    function compareTodoScore(a, b) {
        return b.score - a.score;
    }

    function getTodosFromInputs() {
        const todoInputs = document.getElementsByClassName("todo-input");
        const dones = document.getElementById("done").getElementsByTagName("p");
        globalList = [];
        for(let todo of todoInputs) {
            if(todo.value != "") {
                globalList.push({name: todo.value});
            }
        }
        for(let done of dones) {
            if(done.innerHTML != "") {
                globalList.push({name: done.innerHTML});
            }
        }
    }

    function getDataFromInputs() {
        getTodosFromInputs();

        const breakdowns = document.getElementsByClassName("breakdown-input");
        console.log(breakdowns);

        globalBreakdownList = [];

        for(let breakdown of breakdowns) {
            if(breakdown.value != "") {
                globalBreakdownList.push(breakdown.value);
            }
        }

        console.log(globalBreakdownList);
    }
    

    async function saveDataFrom(area) {
        if (area == "todos") {
            getTodosFromInputs();

            const body = {list: globalList};
            const bodyJSON = JSON.stringify(body);

            const request = new Request('https://api.npoint.io/09f00b9000d1a3a5902a', {
                method: 'POST',
                body: bodyJSON,
                headers: {'Authorization': 'Bearer PhKqhyh2LEhtBbRPLABwB7pq'}
            });

            thatFetchStuff(request);
        } else if (area == "projects") {

        }
    }

    // saves all data from the app instead of just one area
    // first, get the data from the html inputs
    // then, send them as a json object to our storage provider
    async function saveAll() {
        getDataFromInputs();

        const body = {
            list: globalList,
            breakdowns: globalBreakdownList
        };
        const bodyJSON = JSON.stringify(body);

        const request = new Request('https://api.npoint.io/09f00b9000d1a3a5902a', {
            method: 'POST',
            body: bodyJSON,
            headers: {'Authorization': 'Bearer PhKqhyh2LEhtBbRPLABwB7pq'}
        });

        thatFetchStuff(request);
    }

    main();




</script>

</html>